/*! jQuery plugin - v0.1.1 - 2014-07-25
* https://github.com/amazingSurge/jquery-asGalleryPicker
* Copyright (c) 2014 amazingSurge; Licensed GPL */
!function(a,b,c,d){"use strict";var e="asGalleryPicker",f=a[e]=function(b,c){var e={};this.element=b,this.$element=a(b),this.options=a.extend({},f.defaults,c,this.$element.data(),e),this.lang="undefined"==typeof f.Strings[this.options.lang]?"en":this.options.lang,this.strings=a.extend({},f.Strings[this.lang],this.options.strings),this.namespace=this.options.namespace,this.components=a.extend(!0,{},this.components),this.classes={skin:this.namespace+"_"+this.options.skin,disabled:this.namespace+"_disabled",active:this.namespace+"_active",empty:this.namespace+"_empty",exist:this.namespace+"_exist",expand:this.namespace+"_expand",hover:this.namespace+"_hover"},this.disabled=!1,this.initialed=!1;var g=this;a.extend(g,{init:function(){this._createHtml(),this.$expand.height(this.options.viewportSize),this.options.disabled&&this.disable(),this.options.skin&&this.$wrap.addClass(this.classes.skin);var a=this.$element.val();this.value=this.options.parse(a),this.count=this.value?this.value.length:0,this.count>0?this._setImages(this.value):this.$wrap.addClass(this.classes.empty),this.$wrap.addClass(this.classes.exist),this._bindEvent(),this.initialed=!0,this._trigger("ready")},_bindEvent:function(){this.$initial.on("click",function(){return g.disabled?void 0:(g.options.add.call(g),!1)}),this.$infoAdd.on("click",function(){return g.disabled?void 0:(g.options.add.call(g),!1)}),this.$infoExpand.on("click",function(){g.disabled||g.$wrap.addClass(g.classes.expand).removeClass(g.classes.exist)}),this.$info.on("mouseenter",function(){g.disabled||g.$info.addClass(g.classes.hover)}).on("mouseleave",function(){g.disabled||g.$info.removeClass(g.classes.hover)}),this.$expand.on("click","."+this.namespace+"-expand-close",function(){return g.disabled?void 0:(g.$wrap.removeClass(g.classes.expand).addClass(g.classes.exist),!1)}),this.$expand.on("click","."+this.namespace+"-expand-add",function(){return g.disabled?void 0:(g.options.add.call(g),!1)}),this.$expand.on("click","."+this.namespace+"-item-remove",a.proxy(function(b){return this.disabled?void 0:(this.remove(a(b.currentTarget).parent().index()),this._updateScrollbar(),!1)},this)),this.$expand.on("mouseenter","."+this.namespace+"-item",a.proxy(function(b){this.disabled||a(b.currentTarget).addClass(this.classes.hover)},this)).on("mouseleave","."+this.namespace+"-item",a.proxy(function(b){this.disabled||a(b.currentTarget).removeClass(this.classes.hover)},this)),this.$expand.on("click","."+this.namespace+"-item-change",a.proxy(function(b){return this.disabled?void 0:(this.options.change.call(g,a(b.currentTarget).parent().index()),!1)},this))},_createHtml:function(){this.$wrap=a(this.options.tpl().replace(/\{\{namespace\}\}/g,this.namespace).replace(/\{\{strings.placeholder\}\}/g,this.strings.placeholder).replace(/\{\{strings.add\}\}/g,this.strings.add).replace(/\{\{strings.count\}\}/g,this.strings.count).replace(/\{\{strings.expand\}\}/g,this.strings.expand)),this.$element.after(this.$wrap),this.$initial=a("."+this.namespace+"-initial",this.$wrap),this.$info=a("."+this.namespace+"-info",this.$wrap),this.$expand=a("."+this.namespace+"-expand",this.$wrap),this.$infoCount=a("."+this.namespace+"-info-count",this.$wrap),this.$infoExpand=a("."+this.namespace+"-info-expand",this.$wrap),this.$infoAdd=a("."+this.namespace+"-info-add",this.$wrap),this.$infoImage=a("."+this.namespace+"-info-image",this.$wrap),this.$expandItems=a("."+this.namespace+"-expand-items",this.$expand)},_trigger:function(a){this.$element.trigger("asGalleryPicker::"+a,this),this.$element.trigger(a+".asGalleryPicker",this),a=a.replace(/\b\w+\b/g,function(a){return a.substring(0,1).toUpperCase()+a.substring(1)});var b="on"+a,c=arguments.length>1?Array.prototype.slice.call(arguments,1):d;"function"==typeof g.options[b]&&g.options[b].apply(g,c)},_update:function(){a(this.$infoCount).text(this.count),this._setState(),this.$element.val(this.val()),this._trigger("change",this.val())},_setState:function(){this.count>0?(this.$infoImage.attr("src",this._getImageByIndex(this.count-1)),this.$wrap.removeClass(this.classes.empty)):(this.$infoImage.attr("src",""),this.$wrap.addClass(this.classes.empty))},_getImageByIndex:function(a){if(a<this.value.length){var b=this.value[a];return this.options.getImage(b)}return null},_setImages:function(b){var c=this;"undefined"!=typeof this.$expand.data("asScrollbar")&&this.$expand.asScrollbar("destory"),this._clearImages();for(var d,e=0;e<b.length;e++)d=b[e],this._addImage(d);this.$expand.asScrollbar({contentClass:c.namespace+"-expand-content",wrapperClass:c.namespace+"-expand-wrapper",barClass:c.namespace+"-expand-scrollbar",handleClass:c.namespace+"-expand-handle"}),this.$expandContent=a("."+this.namespace+"-expand-content",this.$expand),this._update()},_addImage:function(b){a("<li/>",{html:'<img src="'+this.options.getImage(b)+'"/><div class="'+this.namespace+'-item-change">'+this.strings.change+'</div><a class="'+this.namespace+'-item-remove" href=""></a>',"class":this.namespace+"-item"}).appendTo(this.$expandItems)},_updateScrollbar:function(){this.$expandContent.height()<this.options.viewportSize&&"undefined"!=typeof this.$expand.data("asScrollbar")&&(this.$expand.asScrollbar("destory"),this.$expandItems=a("."+this.namespace+"-expand-items",this.$expand))},_clearImages:function(){this.$expandItems=a("."+this.namespace+"-expand-items",this.$expand),this.$expandItems.children("."+this.namespace+"-item").remove()}}),this._trigger("init"),this.init()};f.prototype={constructor:f,components:{},val:function(a){if("undefined"==typeof a)return this.options.process(this.value);var b=this.options.parse(a);b?this.set(b):this.clear()},add:function(a){this.value.push(a),this.count=this.value.length,this._addImage(a),this._update(),this._trigger("change")},set:function(b,c){if(c!==!1)this.value=a.isArray(b)?b:[];else if(a.isArray(b)){var d=b.join(","),e=this.value&&this.value.length>0?this.value.join(",")+",":"",f=e+d;this.value=f.split(",")}else this.value=[];this.count=this.value.length,this._setImages(this.value),this._updateScrollbar()},change:function(a,b){this.value[a]=b,this.$expandItems.children().eq(a).find("img").attr("src",this.options.getImage(b)),this._update()},remove:function(a){this.value.splice(a,1),this.count-=1,this.$expandItems.children().eq(a).remove(),this._update()},clear:function(){this._clearImages(),this.count=0,this.value=[],this._update()},enable:function(){this.disabled=!1,this.$wrap.removeClass(this.classes.disabled)},disable:function(){this.disabled=!0,this.$wrap.addClass(this.classes.disabled)},destory:function(){this.$element.data(e,null),this.$wrap.remove(),this._trigger("destory")}},f.defaults={namespace:e,skin:null,lang:"en",viewportSize:"330",disabled:!1,tpl:function(){return'<div class="{{namespace}}"><div class="{{namespace}}-initial"><i></i>{{strings.placeholder}}</div><div class="{{namespace}}-info"><img class="{{namespace}}-info-image" src=""><span class="{{namespace}}-info-count">{{strings.count}}</span><div class="{{namespace}}-info-add">{{strings.add}}</div><div class="{{namespace}}-info-expand">{{strings.expand}}</div></div><div class="{{namespace}}-expand"><a class="{{namespace}}-expand-close" href="#"></a><div class="{{namespace}}-expand-add"><i></i>{{strings.add}}</div><ul class="{{namespace}}-expand-items"></ul></div></div>'},process:function(a){return a?a.join(","):""},parse:function(a){if("string"==typeof a&&0!==a.length){var b=[];return b=a.split(",")}return null},getImage:function(a){return a},change:function(){},add:function(){},onChange:function(){}},f.Strings={},f.localize=function(a,b){f.Strings[a]=b},f.localize("en",{placeholder:"Click to upload",count:"zero",add:"Add image",expand:"expand",change:"change"}),f.registerComponent=function(a,b){f.prototype.components[a]=b},a.fn[e]=function(b){if("string"!=typeof b)return this.each(function(){a.data(this,e)||a.data(this,e,new f(this,b))});var c=b,g=arguments.length>1?Array.prototype.slice.call(arguments,1):d;if(/^\_/.test(c))return!1;if(!(/^(get)$/.test(c)||"val"===c&&g===d))return this.each(function(){var b=a.data(this,e);b&&"function"==typeof b[c]&&b[c].apply(b,g)});var h=this.first().data(e);return h&&"function"==typeof h[c]?h[c].apply(h,g):void 0}}(jQuery,document,window);