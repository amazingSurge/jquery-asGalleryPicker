/*! jQuery plugin - v0.1.0 - 2014-07-01
* https://github.com/amazingSurge/jquery-asGalleryPicker
* Copyright (c) 2014 amazingSurge; Licensed GPL */
!function(a,b,c,d){"use strict";var e="asGalleryPicker",f=a[e]=function(b,c){var e={};this.element=b,this.$element=a(b),this.name=this.$element.attr("name")?this.$element.attr("name"):c.name,this.options=a.extend({},f.defaults,c,this.$element.data(),e),this.namespace=this.options.namespace,this.components=a.extend(!0,{},this.components),this.classes={skin:this.namespace+"_"+this.options.skin,disabled:this.namespace+"_disabled",active:this.namespace+"_active",empty:this.namespace+"_empty",present:this.namespace+"_present",extend:this.namespace+"_extend",hover:this.namespace+"_hover",hasImages:this.namespace+"_hasImages"},this.disabled=!1,this.initialed=!1;var g=this;a.extend(g,{init:function(){this._createHtml(),this.options.disabled&&this.disable(),this.options.skin&&this.$wrap.addClass(this.classes.skin),this.$wrap.addClass(this.classes.present),this._getValue(),this._val(this.value,!0),this._bindEvent(),this.initialed=!0,this._trigger("ready")},_bindEvent:function(){this.$initial.on("click",function(){return g.disabled?void 0:(g._trigger("add"),!1)}),this.$actions.on("click",function(){return g.disabled?void 0:(g._trigger("add"),!1)}),this.$unfold.on("click",function(){g.disabled||g.$wrap.addClass(g.classes.extend).removeClass(g.classes.present)}),this.$display.on("mouseenter",function(){g.disabled||g.$display.addClass(g.classes.hover)}).on("mouseleave",function(){g.disabled||g.$display.removeClass(g.classes.hover)}),this.$close.on("click",function(){return g.disabled?void 0:(g.$wrap.removeClass(g.classes.extend).addClass(g.classes.present),!1)}),this.$extendInitial.on("click",function(){return g.disabled?void 0:(g._trigger("add"),!1)}),this.$extend.on("click","."+this.namespace+"-extend-remove",a.proxy(function(b){return this.disabled?void 0:(this.delete(a(b.currentTarget).parent().index()),!1)},this)),this.$extend.on("mouseenter","."+this.namespace+"-item",a.proxy(function(b){this.disabled||a(b.currentTarget).addClass(this.classes.hover)},this)).on("mouseleave","."+this.namespace+"-item",a.proxy(function(b){this.disabled||a(b.currentTarget).removeClass(this.classes.hover)},this)),this.$extend.on("click","."+this.namespace+"-extend-actions",a.proxy(function(b){return this.disabled?void 0:(this.changeIndex=a(b.currentTarget).parent().index(),this._trigger("change"),!1)},this))},_createHtml:function(){this.$wrap=a(this.options.tpl()),this.$element.after(this.$wrap),this.$display=a("."+this.namespace+"-display",this.$wrap),this.$extend=a("."+this.namespace+"-extend",this.$wrap),this.$initial=a("."+this.namespace+"-initial",this.$wrap),this.$count=a("."+this.namespace+"-count",this.$wrap),this.$unfold=a("."+this.namespace+"-unfold",this.$wrap),this.$actions=a("."+this.namespace+"-actions",this.$wrap),this.$image=a("."+this.namespace+"-image",this.$wrap),this.$close=a("."+this.namespace+"-close",this.$extend),this.$gallery=a("."+this.namespace+"-gallery",this.$extend),this.$extendInitial=a("."+this.namespace+"-item-initial",this.$extend)},_trigger:function(a){this.$element.trigger("asGalleryPicker::"+a,this),this.$element.trigger(a+".asGalleryPicker",this),a=a.replace(/\b\w+\b/g,function(a){return a.substring(0,1).toUpperCase()+a.substring(1)});var b="on"+a,c=arguments.length>1?Array.prototype.slice.call(arguments,1):d;"function"==typeof g.options[b]&&g.options[b].apply(g,c)},_getValue:function(){var a=this.$element.val();this.value=this.options.parse(a),this.images_arry=this.options.getImages.call(this,this.value)||[],this.count=this.value?this.images_arry.length:0},_submit:function(){a(this.$count).text(this.count),this._setState(),this.$element.val(this.options.process(this.images_arry))},_setState:function(){this.count>0?(this.$image.attr("src",this.images_arry[this.count-1]),this.$wrap.removeClass(this.classes.empty).addClass(this.classes.hasImages)):(this.$image.attr("src",""),this.$wrap.removeClass(this.classes.hasImages).addClass(this.classes.empty))}}),this._trigger("init"),this.init()};f.prototype={constructor:f,components:{},_val:function(a,b){return"undefined"==typeof a?this.value:void(a?this._set(a,b):this.clear(b))},_set:function(b){for(var c,d=0;c=b[d];d++)a("<li/>",{html:'<img class="'+this.namespace+'-item-image" src="'+c+'"/><div class="'+this.namespace+'-extend-actions">Change</div><a class="'+this.namespace+'-extend-remove" href=""></a>',"class":this.namespace+"-item"}).insertBefore(this.$extendInitial);this._submit()},add:function(a){for(var b in a)this.images_arry.push(a[b]);this.count=this.images_arry.length,this._set(a)},change:function(a){this.images_arry[this.changeIndex]=a,this.$gallery.children().eq(this.changeIndex).find("img").attr("src",a),this._submit()},"delete":function(a){this.images_arry.splice(a,1),this.count-=1,this.$gallery.children().eq(a).remove(),this._submit()},clear:function(){for(var a=0;a<this.count;a++)this.$gallery.children().eq(0).remove();this.count=0,this.images_arry=[],this._submit()},enable:function(){this.disabled=!1,this.$wrap.removeClass(this.classes.disabled)},disable:function(){this.disabled=!0,this.$wrap.addClass(this.classes.disabled)},destory:function(){this.$element.data(e,null),this.$wrap.remove(),this._trigger("destory")}},f.defaults={namespace:e,skin:null,lang:"en",disabled:!1,name:null,tpl:function(){return'<div class="'+this.namespace+'"><div class="'+this.namespace+'-display"><div class="'+this.namespace+'-initial"><i></i>Drag a image or click here to upload</div><div class="'+this.namespace+'-info"><img class="'+this.namespace+'-image" src=""><span class="'+this.namespace+'-count">more</span><div class="'+this.namespace+'-actions">Add image</div><div class="'+this.namespace+'-unfold">extend</div></div></div><div class="'+this.namespace+'-extend"><a class="'+this.namespace+'-close" href="#"></a><ul class="'+this.namespace+'-gallery"><li class="'+this.namespace+'-item-initial"><div class="'+this.namespace+'-extend-initial"><i></i>Add image</div></li></ul></div></div>'},process:function(a){return a?a.join(","):""},parse:function(a){if(a){var b=new Array;return b=a.split(",")}return null},getImages:function(a){return a},onAdd:function(){},onChange:function(){},onSelect:function(){},onUpdate:function(){}},f.registerComponent=function(a,b){f.prototype.components[a]=b},a.fn[e]=function(b){if("string"!=typeof b)return this.each(function(){a.data(this,e)||a.data(this,e,new f(this,b))});var c=b,g=arguments.length>1?Array.prototype.slice.call(arguments,1):d;if(/^\_/.test(c))return!1;if(!(/^(getTabs)$/.test(c)||"val"===c&&g===d))return this.each(function(){var b=a.data(this,e);b&&"function"==typeof b[c]&&b[c].apply(b,g)});var h=this.first().data(e);return h&&"function"==typeof h[c]?h[c].apply(h,g):void 0}}(jQuery,document,window);